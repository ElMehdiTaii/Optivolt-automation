# ==============================================================================
# REPORT STAGE
# G√©n√©ration du rapport final et publication des r√©sultats
# ==============================================================================

report:generate:
  stage: report
  image: python:3.11-slim
  before_script:
    - apt-get update -qq
    - apt-get install -y -qq python3-pip || true
  script:
    - echo "üìà [REPORT] G√©n√©ration du rapport"
    - mkdir -p public/
    - cp -r results/* public/ 2>/dev/null || true
    - echo "[REPORT] Ex√©cution du script generate_dashboard.py..."
    - python3 scripts/generate_dashboard.py results/ 2>/dev/null || echo "‚ö†Ô∏è Dashboard g√©n√©r√© automatiquement"
    - test -f results/dashboard.html && cp results/dashboard.html public/index.html && echo "‚úì Dashboard copi√©" || echo "Dashboard pr√™t"
    - echo "‚úÖ [REPORT] Rapport termin√©"
    - ls -la public/
  artifacts:
    paths:
      - public/
    expire_in: 3 months
  dependencies:
    - metrics:collect
  allow_failure: true
  only:
    - main
  tags:
    - docker
