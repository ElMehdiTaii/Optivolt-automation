# ==============================================================================
# METRICS STAGE
# Collecte des m√©triques syst√®me et workload benchmark
# ==============================================================================

metrics:collect:
  stage: metrics
  image: python:3.11-slim
  before_script:
    - pip install --no-cache-dir psutil
  script:
    - echo "========================================="
    - echo "üìä [METRICS] Collecte des m√©triques"
    - echo "========================================="
    - mkdir -p results/
    # Ex√©cution du workload benchmark
    - echo "[METRICS] Ex√©cution du workload benchmark..."
    - python3 scripts/workload_benchmark.py
    - test -f /tmp/workload_results.json && cp /tmp/workload_results.json results/ || echo "Workload results manquants"
    # G√©n√©ration des autres m√©triques
    - echo "[METRICS] G√©n√©ration des m√©triques syst√®me..."
    - python3 scripts/generate_metrics.py
    - echo ""
    - echo "‚úÖ [METRICS] M√©triques collect√©es"
    - ls -lah results/
    - echo "========================================="
  artifacts:
    paths:
      - results/
    expire_in: 1 month
  allow_failure: false
  tags:
    - docker
